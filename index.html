<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupplyChain | Decentralized Supply Chain Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --dark: #0f172a;
            --darker: #0a0f1f;
            --light: #f8f9fa;
            --success: #4ade80;
            --warning: #facc15;
            --danger: #f87171;
            --card-bg: rgba(15, 23, 42, 0.7);
            --border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.15;
        }

        .bg-particle {
            position: absolute;
            background: linear-gradient(45deg, var(--accent), var(--primary));
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(180deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(67, 97, 238, 0.1) 0%, transparent 70%);
            z-index: -1;
            animation: rotate 15s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            max-width: 600px;
            margin: 0 auto;
        }

        .wallet-section {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .wallet-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .wallet-icon {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .connect-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connect-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(67, 97, 238, 0.4);
        }

        .connect-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.2);
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            overflow-x: auto;
            border: 1px solid var(--border);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .tab {
            flex: 1;
            padding: 18px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.3);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .card-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--accent);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(67, 97, 238, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #37474f, #455a64);
            box-shadow: 0 10px 25px rgba(55, 71, 79, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 35px rgba(55, 71, 79, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #2e7d32, #388e3c);
            box-shadow: 0 10px 25px rgba(46, 125, 50, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 15px 35px rgba(46, 125, 50, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f57c00, #ef6c00);
            box-shadow: 0 10px 25px rgba(245, 124, 0, 0.3);
        }

        .btn-warning:hover {
            box-shadow: 0 15px 35px rgba(245, 124, 0, 0.4);
        }

        .product-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .product-id {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px;
        }

        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .status-approved {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .alert i {
            font-size: 1.2rem;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(244, 67, 54, 0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--accent), var(--primary));
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            margin-left: 30px;
            border: 1px solid var(--border);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -47px;
            top: 25px;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.5);
            border: 3px solid var(--dark);
        }

        .timeline-item.current::before {
            background: var(--success);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timeline-date {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
        }

        .role-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            background: rgba(67, 97, 238, 0.2);
            border: 1px solid var(--primary);
            color: var(--accent);
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.2);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .tabs {
                overflow-x: scroll;
            }
            
            .tab {
                min-width: 140px;
                padding: 15px;
                font-size: 14px;
            }
            
            .wallet-section {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 20px;
            }
            
            .card-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="animated-bg" id="animatedBg"></div>
    
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-link"></i> SupplyChain</h1>
            <p>Blockchain-powered transparency and traceability for supply chain management</p>
        </header>

        <div class="wallet-section">
            <div class="wallet-info">
                <div class="wallet-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div>
                    <div id="walletStatus">Wallet Status</div>
                    <div id="accountAddress">Not Connected</div>
                </div>
            </div>
            <button id="connectWallet" class="connect-btn">
                <i class="fas fa-plug"></i> Connect Wallet
            </button>
        </div>

        <div id="alertContainer"></div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-chart-pie"></i> Dashboard
            </button>
            <button class="tab" onclick="switchTab('products')">
                <i class="fas fa-boxes"></i> Products
            </button>
            <button class="tab" onclick="switchTab('create')">
                <i class="fas fa-plus-circle"></i> Create Product
            </button>
            <button class="tab" onclick="switchTab('quality')">
                <i class="fas fa-clipboard-check"></i> Quality Control
            </button>
            <button class="tab" onclick="switchTab('logistics')">
                <i class="fas fa-truck"></i> Logistics
            </button>
            <button class="tab" onclick="switchTab('admin')">
                <i class="fas fa-user-shield"></i> Admin
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-box fa-2x"></i>
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="totalProducts">0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle fa-2x"></i>
                    <div class="stat-label">Approved Products</div>
                    <div class="stat-value" id="approvedProducts">0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users fa-2x"></i>
                    <div class="stat-label">Registered Roles</div>
                    <div class="stat-value" id="registeredRoles">0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exchange-alt fa-2x"></i>
                    <div class="stat-label">Total Transfers</div>
                    <div class="stat-value" id="totalTransfers">0</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h2 class="card-title">Recent Activity</h2>
                </div>
                <div id="recentActivity">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No Activity Yet</h3>
                        <p>Connect your wallet to see recent activity</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h2 class="card-title">Product Search & Tracking</h2>
                </div>
                <div class="form-group">
                    <label for="searchProductId">Product ID</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="searchProductId" placeholder="Enter Product ID">
                        <button class="btn" onclick="searchProduct()">
                            <i class="fas fa-search"></i> Search
                        </button>
                        <button class="btn btn-secondary" onclick="loadAllProducts()">
                            <i class="fas fa-sync"></i> Load All
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h2 class="card-title">Entity Search</h2>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label for="searchProducerAddress">Producer Address</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchProducerAddress" placeholder="0x...">
                            <button class="btn" onclick="searchProducer()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="searchInspectorAddress">Quality Inspector Address</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchInspectorAddress" placeholder="0x...">
                            <button class="btn" onclick="searchInspector()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="searchDistributorAddress">Distributor Address</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchDistributorAddress" placeholder="0x...">
                            <button class="btn" onclick="searchDistributor()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="searchRetailerAddress">Retailer Address</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchRetailerAddress" placeholder="0x...">
                            <button class="btn" onclick="searchRetailer()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="productsContainer">
                <div class="empty-state">
                    <i class="fas fa-box-open"></i>
                    <h3>No Products Found</h3>
                    <p>Search for a product or create a new one</p>
                </div>
            </div>
        </div>

        <!-- Create Product Tab -->
        <div id="create" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-plus"></i>
                    </div>
                    <h2 class="card-title">Create New Product</h2>
                </div>
                <form id="createProductForm">
                    <div class="grid">
                        <div class="form-group">
                            <label for="productName">Product Name</label>
                            <input type="text" id="productName" required placeholder="e.g., Organic Milk">
                        </div>
                        <div class="form-group">
                            <label for="batchId">Batch ID</label>
                            <input type="text" id="batchId" required placeholder="e.g., BATCH-001">
                        </div>
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select id="category" required>
                                <option value="">Select Category</option>
                                <option value="Food">Food</option>
                                <option value="Pharmaceutical">Pharmaceutical</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Textiles">Textiles</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productionDate">Production Date</label>
                            <input type="date" id="productionDate" required>
                        </div>
                        <div class="form-group">
                            <label for="metadataURI">Metadata URI (Optional)</label>
                            <input type="url" id="metadataURI" placeholder="https://...">
                        </div>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-box"></i> Create Product
                    </button>
                </form>
            </div>
        </div>

        <!-- Quality Control Tab -->
        <div id="quality" class="tab-content">
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h2 class="card-title">Assign Quality Inspector</h2>
                    </div>
                    <div class="form-group">
                        <label for="assignProductId">Product ID</label>
                        <input type="number" id="assignProductId" placeholder="Enter Product ID">
                    </div>
                    <div class="form-group">
                        <label for="inspectorAddress">Inspector Address</label>
                        <input type="text" id="inspectorAddress" placeholder="0x...">
                    </div>
                    <button class="btn" onclick="assignQualityInspector()">
                        <i class="fas fa-user-tag"></i> Assign Inspector
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <h2 class="card-title">Add Certification</h2>
                    </div>
                    <div class="form-group">
                        <label for="certProductId">Product ID</label>
                        <input type="number" id="certProductId" placeholder="Enter Product ID">
                    </div>
                    <div class="form-group">
                        <label for="certification">Certification</label>
                        <input type="text" id="certification" placeholder="e.g., ISO 9001, FDA Approved">
                    </div>
                    <button class="btn" onclick="addCertification()">
                        <i class="fas fa-plus-circle"></i> Add Certification
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <h2 class="card-title">Approve Quality</h2>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label for="approveProductId">Product ID</label>
                        <input type="number" id="approveProductId" placeholder="Enter Product ID">
                    </div>
                    <div class="form-group">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="date" id="expiryDate">
                    </div>
                </div>
                <button class="btn btn-success" onclick="approveQuality()">
                    <i class="fas fa-thumbs-up"></i> Approve Quality
                </button>
            </div>
        </div>

        <!-- Logistics Tab -->
        <div id="logistics" class="tab-content">
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-truck-loading"></i>
                        </div>
                        <h2 class="card-title">Assign Distributor</h2>
                    </div>
                    <div class="form-group">
                        <label for="distProductId">Product ID</label>
                        <input type="number" id="distProductId" placeholder="Enter Product ID">
                    </div>
                    <div class="form-group">
                        <label for="distributorAddress">Distributor Address</label>
                        <input type="text" id="distributorAddress" placeholder="0x...">
                    </div>
                    <button class="btn" onclick="assignDistributor()">
                        <i class="fas fa-truck"></i> Assign Distributor
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <h2 class="card-title">Assign Retailer</h2>
                    </div>
                    <div class="form-group">
                        <label for="retailProductId">Product ID</label>
                        <input type="number" id="retailProductId" placeholder="Enter Product ID">
                    </div>
                    <div class="form-group">
                        <label for="retailerAddress">Retailer Address</label>
                        <input type="text" id="retailerAddress" placeholder="0x...">
                    </div>
                    <button class="btn" onclick="assignRetailer()">
                        <i class="fas fa-store-alt"></i> Assign Retailer
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h2 class="card-title">Sell to Consumer</h2>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label for="sellProductId">Product ID</label>
                        <input type="number" id="sellProductId" placeholder="Enter Product ID">
                    </div>
                    <div class="form-group">
                        <label for="consumerAddress">Consumer Address</label>
                        <input type="text" id="consumerAddress" placeholder="0x...">
                    </div>
                </div>
                <button class="btn btn-success" onclick="sellToConsumer()">
                    <i class="fas fa-handshake"></i> Sell to Consumer
                </button>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-users-cog"></i>
                    </div>
                    <h2 class="card-title">Role Management</h2>
                </div>
                <div class="grid">
                    <div class="card">
                        <h3><i class="fas fa-seedling"></i> Register Producer</h3>
                        <div class="form-group">
                            <label for="producerAddr">Address</label>
                            <input type="text" id="producerAddr" placeholder="0x...">
                        </div>
                        <div class="form-group">
                            <label for="producerDetails">Details</label>
                            <input type="text" id="producerDetails" placeholder="Company name, location...">
                        </div>
                        <button class="btn" onclick="registerProducer()">
                            <i class="fas fa-user-plus"></i> Register Producer
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3><i class="fas fa-searchengin"></i> Register Quality Inspector</h3>
                        <div class="form-group">
                            <label for="inspectorAddr">Address</label>
                            <input type="text" id="inspectorAddr" placeholder="0x...">
                        </div>
                        <div class="form-group">
                            <label for="inspectorDetails">Details</label>
                            <input type="text" id="inspectorDetails" placeholder="Certification body...">
                        </div>
                        <button class="btn" onclick="registerQualityInspector()">
                            <i class="fas fa-user-plus"></i> Register Inspector
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3><i class="fas fa-truck-moving"></i> Register Distributor</h3>
                        <div class="form-group">
                            <label for="distributorAddr">Address</label>
                            <input type="text" id="distributorAddr" placeholder="0x...">
                        </div>
                        <div class="form-group">
                            <label for="distributorDetails">Details</label>
                            <input type="text" id="distributorDetails" placeholder="Company name, location...">
                        </div>
                        <button class="btn" onclick="registerDistributor()">
                            <i class="fas fa-user-plus"></i> Register Distributor
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3><i class="fas fa-cash-register"></i> Register Retailer</h3>
                        <div class="form-group">
                            <label for="retailerAddr">Address</label>
                            <input type="text" id="retailerAddr" placeholder="0x...">
                        </div>
                        <div class="form-group">
                            <label for="retailerDetails">Details</label>
                            <input type="text" id="retailerDetails" placeholder="Store name, location...">
                        </div>
                        <button class="btn" onclick="registerRetailer()">
                            <i class="fas fa-user-plus"></i> Register Retailer
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Contract configuration
        const CONTRACT_ADDRESS = '0xD0927883Df1e10F36FdE44e6cd21ccA8Eaee7729'; // Replace with your deployed contract address
        const CONTRACT_ABI = [
            "function i_owner() view returns (address)",
            "function nextProductId() view returns (uint256)",
            "function isProducerRegistered(address) view returns (bool)",
            "function isQualityInspectorRegistered(address) view returns (bool)",
            "function isDistributorRegistered(address) view returns (bool)",
            "function isRetailerRegistered(address) view returns (bool)",
            "function createProduct(string calldata _name, string calldata _batchId, string calldata _category, uint256 _productionDate, string calldata _metadataURI) external returns (uint256)",
            "function getBasicProductInfo(uint256 productId) external view returns (uint256 id, string memory name, string memory batchId, string memory category, address producer, address currentOwner, bool qualityApproved)",
            "function getFullProductDetails(uint256 productId) external view returns (uint256 id, string memory name, string memory batchId, string memory category, address producer, uint256 productionDate, uint256 expiryDate, address qualityInspector, bool qualityApproved, address distributor, address retailer, address currentOwner)",
            "function assignQualityInspector(uint256 productId, address inspector) external",
            "function addCertification(uint256 productId, string calldata certification) external",
            "function approveQuality(uint256 productId, uint256 expiryDate) external",
            "function assignDistributor(uint256 productId, address distributor) external",
            "function assignRetailer(uint256 productId, address retailer) external",
            "function sellToConsumer(uint256 productId, address buyer) external",
            "function registerProducer(address _producer, string calldata _details) external",
            "function registerQualityInspector(address _inspector, string calldata _details) external",
            "function registerDistributor(address _distributor, string calldata _details) external",
            "function registerRetailer(address _retailer, string calldata _details) external",
            "function getOwnershipHistory(uint256 productId) external view returns (address[] memory, uint256[] memory)",
            "function getProducerDetails(address producer) view returns (string memory)",
            "function getQualityInspectorDetails(address inspector) view returns (string memory)",
            "function getDistributorDetails(address distributor) view returns (string memory)",
            "function getRetailerDetails(address retailer) view returns (string memory)",
            "function producersList(uint256) view returns (address)",
            "function qualityInspectorsList(uint256) view returns (address)",
            "function distributorsList(uint256) view returns (address)",
            "function retailersList(uint256) view returns (address)",
            "function totalProducers() view returns (uint256)",
            "function totalQualityInspectors() view returns (uint256)",
            "function totalDistributors() view returns (uint256)",
            "function totalRetailers() view returns (uint256)"
        ];

        let provider;
        let signer;
        let contract;
        let userAccount;

        // Initialize animated background
        function initAnimatedBackground() {
            const bg = document.getElementById('animatedBg');
            for (let i = 0; i < 25; i++) {
                const particle = document.createElement('div');
                particle.className = 'bg-particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = Math.random() * 8 + 3 + 'px';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 6 + 6) + 's';
                bg.appendChild(particle);
            }
        }

        // Connect wallet
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    userAccount = await signer.getAddress();
                    
                    if (CONTRACT_ADDRESS !== 'YOUR_CONTRACT_ADDRESS_HERE') {
                        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                        await updateDashboard();
                    }
                    
                    document.getElementById('accountAddress').textContent = 
                        userAccount.slice(0, 6) + '...' + userAccount.slice(-4);
                    document.getElementById('walletStatus').textContent = 'Connected';
                    document.getElementById('connectWallet').innerHTML = '<i class="fas fa-check"></i> Connected';
                    document.getElementById('connectWallet').disabled = true;
                    
                    showAlert('Wallet connected successfully!', 'success');
                } catch (error) {
                    showAlert('Failed to connect wallet: ' + error.message, 'error');
                }
            } else {
                showAlert('Please install MetaMask!', 'error');
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'dashboard' && contract) {
                updateDashboard();
            }
        }

        // Alert system
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            alert.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
            
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Show loading state
        function showLoading(button) {
            const originalHTML = button.innerHTML;
            button.innerHTML += '<span class="loading"></span>';
            button.disabled = true;
            return originalHTML;
        }

        function hideLoading(button, originalHTML) {
            button.innerHTML = originalHTML;
            button.disabled = false;
        }

        // Dashboard functions
        async function updateDashboard() {
            if (!contract) return;
            
            try {
                // Get total products
                const nextProductId = await contract.nextProductId();
                document.getElementById('totalProducts').textContent = nextProductId - 1;
                
                // Get approved products count
                let approvedCount = 0;
                for (let i = 1; i < nextProductId; i++) {
                    try {
                        const productInfo = await contract.getBasicProductInfo(i);
                        if (productInfo[6]) approvedCount++;
                    } catch (error) {
                        console.log(`Product ${i} not found`);
                    }
                }
                document.getElementById('approvedProducts').textContent = approvedCount;
                
                // Get registered roles count
                let producersCount = 0;
                let inspectorsCount = 0;
                let distributorsCount = 0;
                let retailersCount = 0;
                
                try {
                    producersCount = await contract.totalProducers();
                    inspectorsCount = await contract.totalQualityInspectors();
                    distributorsCount = await contract.totalDistributors();
                    retailersCount = await contract.totalRetailers();
                } catch (error) {
                    console.log("Error getting roles count");
                }
                
                const rolesCount = producersCount + inspectorsCount + distributorsCount + retailersCount;
                document.getElementById('registeredRoles').textContent = rolesCount;
                
                // Get transfers count (simplified)
                document.getElementById('totalTransfers').textContent = nextProductId > 1 ? (nextProductId - 1) * 2 : 0;
                
                // Update recent activity
                updateRecentActivity();
            } catch (error) {
                console.log("Error updating dashboard:", error);
            }
        }

        function updateRecentActivity() {
            const activityContainer = document.getElementById('recentActivity');
            activityContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-history"></i>
                    <h3>Recent Activity</h3>
                    <p>Product lifecycle events will appear here</p>
                </div>
            `;
        }

        // Create product
        async function createProduct(event) {
            event.preventDefault();
            
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const name = document.getElementById('productName').value;
            const batchId = document.getElementById('batchId').value;
            const category = document.getElementById('category').value;
            const productionDate = new Date(document.getElementById('productionDate').value).getTime() / 1000;
            const metadataURI = document.getElementById('metadataURI').value || '';

            const button = document.querySelector('#createProductForm button');
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.createProduct(name, batchId, category, productionDate, metadataURI);
                await tx.wait();
                showAlert('Product created successfully!', 'success');
                document.getElementById('createProductForm').reset();
                
                // Update dashboard
                if (document.getElementById('dashboard').classList.contains('active')) {
                    updateDashboard();
                }
            } catch (error) {
                showAlert('Error creating product: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        // Search product
        async function searchProduct() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('searchProductId').value;
            if (!productId) {
                showAlert('Please enter a Product ID!', 'error');
                return;
            }

            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="card"><p>Loading product...</p></div>';

            try {
                const productInfo = await contract.getBasicProductInfo(productId);
                const ownershipHistory = await contract.getOwnershipHistory(productId);
                
                displayProduct({
                    id: productInfo[0],
                    name: productInfo[1],
                    batchId: productInfo[2],
                    category: productInfo[3],
                    producer: productInfo[4],
                    currentOwner: productInfo[5],
                    qualityApproved: productInfo[6],
                    ownersHistory: ownershipHistory[0],
                    transferTimestamps: ownershipHistory[1]
                });
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Product Not Found</h3>
                        <p>The product with ID ${productId} could not be found</p>
                    </div>
                `;
                showAlert('Product not found or error: ' + error.message, 'error');
            }
        }

        // Display product with enhanced details
        async function displayProduct(product) {
            const container = document.getElementById('productsContainer');
            
            // Get full product details if available
            let fullProductDetails = null;
            try {
                if (contract && product.id) {
                    fullProductDetails = await contract.getFullProductDetails(product.id);
                }
            } catch (error) {
                console.log("Error getting full product details:", error);
            }
            
            // Format ownership history
            let timelineHTML = '';
            if (product.ownersHistory && product.ownersHistory.length > 0) {
                for (let i = 0; i < product.ownersHistory.length; i++) {
                    const owner = product.ownersHistory[i];
                    const timestamp = product.transferTimestamps && product.transferTimestamps[i] 
                        ? new Date(Number(product.transferTimestamps[i]) * 1000).toLocaleString()
                        : 'N/A';
                    
                    const isCurrent = i === product.ownersHistory.length - 1;
                    const role = await getRoleForAddress(owner);
                    
                    timelineHTML += `
                        <div class="timeline-item ${isCurrent ? 'current' : ''}">
                            <div class="timeline-title">
                                <span>${owner}</span>
                                <span class="role-badge">${role}</span>
                            </div>
                            <div class="timeline-date">${timestamp}</div>
                        </div>
                    `;
                }
            }
            
            // Get role details if available
            let producerDetails = '';
            let inspectorDetails = '';
            let distributorDetails = '';
            let retailerDetails = '';
            
            try {
                if (fullProductDetails && fullProductDetails[4]) { // producer
                    if (await contract.isProducerRegistered(fullProductDetails[4])) {
                        producerDetails = await contract.getProducerDetails(fullProductDetails[4]);
                    }
                }
                
                if (fullProductDetails && fullProductDetails[7]) { // qualityInspector
                    if (await contract.isQualityInspectorRegistered(fullProductDetails[7])) {
                        inspectorDetails = await contract.getQualityInspectorDetails(fullProductDetails[7]);
                    }
                }
                
                if (fullProductDetails && fullProductDetails[9]) { // distributor
                    if (await contract.isDistributorRegistered(fullProductDetails[9])) {
                        distributorDetails = await contract.getDistributorDetails(fullProductDetails[9]);
                    }
                }
                
                if (fullProductDetails && fullProductDetails[10]) { // retailer
                    if (await contract.isRetailerRegistered(fullProductDetails[10])) {
                        retailerDetails = await contract.getRetailerDetails(fullProductDetails[10]);
                    }
                }
            } catch (error) {
                console.log("Error getting role details:", error);
            }
            
            // Use full addresses from fullProductDetails if available, otherwise use from product
            const producerAddress = fullProductDetails && fullProductDetails[4] ? fullProductDetails[4] : (product.producer || 'N/A');
            const inspectorAddress = fullProductDetails && fullProductDetails[7] ? fullProductDetails[7] : (product.qualityInspector || 'N/A');
            const distributorAddress = fullProductDetails && fullProductDetails[9] ? fullProductDetails[9] : (product.distributor || 'N/A');
            const retailerAddress = fullProductDetails && fullProductDetails[10] ? fullProductDetails[10] : (product.retailer || 'N/A');
            const currentOwnerAddress = fullProductDetails && fullProductDetails[11] ? fullProductDetails[11] : (product.currentOwner || 'N/A');
            
            container.innerHTML = `
                <div class="product-card">
                    <div class="product-id">ID: ${product.id}</div>
                    <h3>${product.name}</h3>
                    <div class="grid">
                        <div>
                            <p><strong>Batch ID:</strong> ${product.batchId}</p>
                            <p><strong>Category:</strong> ${product.category}</p>
                            <p><strong>Producer:</strong> ${producerAddress}</p>
                            ${producerDetails ? `<p><strong>Producer Details:</strong> ${producerDetails}</p>` : ''}
                        </div>
                        <div>
                            <p><strong>Current Owner:</strong> ${currentOwnerAddress}</p>
                            <p><strong>Quality Status:</strong> 
                                <span class="status-badge ${product.qualityApproved ? 'status-approved' : 'status-pending'}">
                                    <i class="fas ${product.qualityApproved ? 'fa-check-circle' : 'fa-clock'}"></i>
                                    ${product.qualityApproved ? 'Approved' : 'Pending'}
                                </span>
                            </p>
                            ${inspectorAddress && inspectorAddress !== '0x0000000000000000000000000000000000000000' ? 
                              `<p><strong>Inspector:</strong> ${inspectorAddress}</p>
                               ${inspectorDetails ? `<p><strong>Inspector Details:</strong> ${inspectorDetails}</p>` : ''}` : ''}
                            ${distributorAddress && distributorAddress !== '0x0000000000000000000000000000000000000000' ? 
                              `<p><strong>Distributor:</strong> ${distributorAddress}</p>
                               ${distributorDetails ? `<p><strong>Distributor Details:</strong> ${distributorDetails}</p>` : ''}` : ''}
                            ${retailerAddress && retailerAddress !== '0x0000000000000000000000000000000000000000' ? 
                              `<p><strong>Retailer:</strong> ${retailerAddress}</p>
                               ${retailerDetails ? `<p><strong>Retailer Details:</strong> ${retailerDetails}</p>` : ''}` : ''}
                        </div>
                    </div>
                    ${timelineHTML ? `
                    <div class="card">
                        <h4><i class="fas fa-route"></i> Ownership Timeline</h4>
                        <div class="timeline">
                            ${timelineHTML}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Helper to determine role for an address
        async function getRoleForAddress(address) {
            if (!contract) return "Participant";
            
            try {
                if (await contract.isProducerRegistered(address)) return "Producer";
                if (await contract.isQualityInspectorRegistered(address)) return "Quality Inspector";
                if (await contract.isDistributorRegistered(address)) return "Distributor";
                if (await contract.isRetailerRegistered(address)) return "Retailer";
            } catch (error) {
                console.log("Error checking role:", error);
            }
            
            if (address === userAccount) return "You";
            return "Participant";
        }

        // Load all products
        async function loadAllProducts() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="card"><p>Loading products...</p></div>';

            try {
                const nextId = await contract.nextProductId();
                
                if (nextId <= 1) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Found</h3>
                            <p>Be the first to create a product!</p>
                        </div>
                    `;
                    return;
                }
                
                let productsHTML = '';
                let foundProducts = 0;
                
                for (let i = 1; i < nextId; i++) {
                    try {
                        const productInfo = await contract.getBasicProductInfo(i);
                        foundProducts++;
                        
                        productsHTML += `
                            <div class="product-card">
                                <div class="product-id">ID: ${i}</div>
                                <h3>${productInfo[1]}</h3>
                                <div class="grid">
                                    <div>
                                        <p><strong>Batch ID:</strong> ${productInfo[2]}</p>
                                        <p><strong>Category:</strong> ${productInfo[3]}</p>
                                    </div>
                                    <div>
                                        <p><strong>Current Owner:</strong> ${productInfo[5].slice(0, 6)}...${productInfo[5].slice(-4)}</p>
                                        <p><strong>Quality Status:</strong> 
                                            <span class="status-badge ${productInfo[6] ? 'status-approved' : 'status-pending'}">
                                                <i class="fas ${productInfo[6] ? 'fa-check-circle' : 'fa-clock'}"></i>
                                                ${productInfo[6] ? 'Approved' : 'Pending'}
                                            </span>
                                        </p>
                                        <button class="btn btn-secondary" onclick="searchSpecificProduct(${i})">
                                            <i class="fas fa-eye"></i> View Details
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    } catch (error) {
                        console.log(`Product ${i} not found or error:`, error.message);
                    }
                }
                
                if (foundProducts === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Found</h3>
                            <p>No products are currently registered in the system</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = productsHTML;
                }
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Error Loading Products</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                showAlert('Error loading products: ' + error.message, 'error');
            }
        }

        // Search specific product for detailed view
        async function searchSpecificProduct(productId) {
            document.getElementById('searchProductId').value = productId;
            await searchProduct();
            // Switch to products tab
            switchTab('products');
        }

        // Search entity functions
        async function searchProducer() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('searchProducerAddress').value;
            if (!address) {
                showAlert('Please enter a Producer address!', 'error');
                return;
            }

            try {
                const isRegistered = await contract.isProducerRegistered(address);
                if (!isRegistered) {
                    showAlert('Producer not registered!', 'error');
                    return;
                }
                
                const details = await contract.getProducerDetails(address);
                showAlert(`Producer found: ${details}`, 'success');
            } catch (error) {
                showAlert('Error searching producer: ' + error.message, 'error');
            }
        }

        async function searchInspector() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('searchInspectorAddress').value;
            if (!address) {
                showAlert('Please enter a Quality Inspector address!', 'error');
                return;
            }

            try {
                const isRegistered = await contract.isQualityInspectorRegistered(address);
                if (!isRegistered) {
                    showAlert('Quality Inspector not registered!', 'error');
                    return;
                }
                
                const details = await contract.getQualityInspectorDetails(address);
                showAlert(`Quality Inspector found: ${details}`, 'success');
            } catch (error) {
                showAlert('Error searching inspector: ' + error.message, 'error');
            }
        }

        async function searchDistributor() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('searchDistributorAddress').value;
            if (!address) {
                showAlert('Please enter a Distributor address!', 'error');
                return;
            }

            try {
                const isRegistered = await contract.isDistributorRegistered(address);
                if (!isRegistered) {
                    showAlert('Distributor not registered!', 'error');
                    return;
                }
                
                const details = await contract.getDistributorDetails(address);
                showAlert(`Distributor found: ${details}`, 'success');
            } catch (error) {
                showAlert('Error searching distributor: ' + error.message, 'error');
            }
        }

        async function searchRetailer() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('searchRetailerAddress').value;
            if (!address) {
                showAlert('Please enter a Retailer address!', 'error');
                return;
            }

            try {
                const isRegistered = await contract.isRetailerRegistered(address);
                if (!isRegistered) {
                    showAlert('Retailer not registered!', 'error');
                    return;
                }
                
                const details = await contract.getRetailerDetails(address);
                showAlert(`Retailer found: ${details}`, 'success');
            } catch (error) {
                showAlert('Error searching retailer: ' + error.message, 'error');
            }
        }

        // Quality control functions
        async function assignQualityInspector() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('assignProductId').value;
            const inspectorAddress = document.getElementById('inspectorAddress').value;

            if (!productId || !inspectorAddress) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.assignQualityInspector(productId, inspectorAddress);
                await tx.wait();
                showAlert('Quality inspector assigned successfully!', 'success');
                document.getElementById('assignProductId').value = '';
                document.getElementById('inspectorAddress').value = '';
            } catch (error) {
                showAlert('Error assigning inspector: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function addCertification() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('certProductId').value;
            const certification = document.getElementById('certification').value;

            if (!productId || !certification) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.addCertification(productId, certification);
                await tx.wait();
                showAlert('Certification added successfully!', 'success');
                document.getElementById('certProductId').value = '';
                document.getElementById('certification').value = '';
            } catch (error) {
                showAlert('Error adding certification: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function approveQuality() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('approveProductId').value;
            const expiryDate = new Date(document.getElementById('expiryDate').value).getTime() / 1000;

            if (!productId || !expiryDate) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.approveQuality(productId, expiryDate);
                await tx.wait();
                showAlert('Quality approved successfully!', 'success');
                document.getElementById('approveProductId').value = '';
                document.getElementById('expiryDate').value = '';
            } catch (error) {
                showAlert('Error approving quality: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        // Logistics functions
        async function assignDistributor() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('distProductId').value;
            const distributorAddress = document.getElementById('distributorAddress').value;

            if (!productId || !distributorAddress) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.assignDistributor(productId, distributorAddress);
                await tx.wait();
                showAlert('Distributor assigned successfully!', 'success');
                document.getElementById('distProductId').value = '';
                document.getElementById('distributorAddress').value = '';
            } catch (error) {
                showAlert('Error assigning distributor: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function assignRetailer() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('retailProductId').value;
            const retailerAddress = document.getElementById('retailerAddress').value;

            if (!productId || !retailerAddress) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.assignRetailer(productId, retailerAddress);
                await tx.wait();
                showAlert('Retailer assigned successfully!', 'success');
                document.getElementById('retailProductId').value = '';
                document.getElementById('retailerAddress').value = '';
            } catch (error) {
                showAlert('Error assigning retailer: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function sellToConsumer() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const productId = document.getElementById('sellProductId').value;
            const consumerAddress = document.getElementById('consumerAddress').value;

            if (!productId || !consumerAddress) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.sellToConsumer(productId, consumerAddress);
                await tx.wait();
                showAlert('Product sold to consumer successfully!', 'success');
                document.getElementById('sellProductId').value = '';
                document.getElementById('consumerAddress').value = '';
            } catch (error) {
                showAlert('Error selling to consumer: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        // Admin functions
        async function registerProducer() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('producerAddr').value;
            const details = document.getElementById('producerDetails').value;

            if (!address || !details) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.registerProducer(address, details);
                await tx.wait();
                showAlert('Producer registered successfully!', 'success');
                document.getElementById('producerAddr').value = '';
                document.getElementById('producerDetails').value = '';
            } catch (error) {
                showAlert('Error registering producer: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function registerQualityInspector() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('inspectorAddr').value;
            const details = document.getElementById('inspectorDetails').value;

            if (!address || !details) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.registerQualityInspector(address, details);
                await tx.wait();
                showAlert('Quality inspector registered successfully!', 'success');
                document.getElementById('inspectorAddr').value = '';
                document.getElementById('inspectorDetails').value = '';
            } catch (error) {
                showAlert('Error registering inspector: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function registerDistributor() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('distributorAddr').value;
            const details = document.getElementById('distributorDetails').value;

            if (!address || !details) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.registerDistributor(address, details);
                await tx.wait();
                showAlert('Distributor registered successfully!', 'success');
                document.getElementById('distributorAddr').value = '';
                document.getElementById('distributorDetails').value = '';
            } catch (error) {
                showAlert('Error registering distributor: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        async function registerRetailer() {
            if (!contract) {
                showAlert('Please connect your wallet first!', 'error');
                return;
            }

            const address = document.getElementById('retailerAddr').value;
            const details = document.getElementById('retailerDetails').value;

            if (!address || !details) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }

            const button = event.currentTarget;
            const originalHTML = showLoading(button);

            try {
                const tx = await contract.registerRetailer(address, details);
                await tx.wait();
                showAlert('Retailer registered successfully!', 'success');
                document.getElementById('retailerAddr').value = '';
                document.getElementById('retailerDetails').value = '';
            } catch (error) {
                showAlert('Error registering retailer: ' + error.message, 'error');
            } finally {
                hideLoading(button, originalHTML);
            }
        }

        // Event listeners
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('createProductForm').addEventListener('submit', createProduct);

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initAnimatedBackground();
            
            // Set today's date as default for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Check if already connected
            if (window.ethereum && window.ethereum.selectedAddress) {
                connectWallet();
            }
        });

        // Handle account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function(accounts) {
                if (accounts.length === 0) {
                    document.getElementById('accountAddress').textContent = 'Not Connected';
                    document.getElementById('walletStatus').textContent = 'Wallet Status';
                    document.getElementById('connectWallet').innerHTML = '<i class="fas fa-plug"></i> Connect Wallet';
                    document.getElementById('connectWallet').disabled = false;
                    contract = null;
                } else {
                    connectWallet();
                }
            });

            window.ethereum.on('chainChanged', function(chainId) {
                window.location.reload();
            });
        }
    </script>
</body>
</html>